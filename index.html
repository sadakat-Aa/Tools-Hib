<!DOCTYPE html>
<html lang="en">
<head>

    <script src="https://fpyf8.com/88/tag.min.js" data-zone="154477" async data-cfasync="false"></script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Tools Hub</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for Inter font and general body styling */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
            color: #333; /* Dark text for light mode */
        }
        /* Dark mode styles (optional, but good practice) */
        @media (prefers-color-scheme: dark) {
            body {
                background-color: #1a202c; /* Dark background */
                color: #e2e8f0; /* Light text for dark mode */
            }
        }
        .container {
            max-width: 960px;
        }
        /* Hide the default file input text and style the custom button */
        input[type="file"]::-webkit-file-upload-button {
            visibility: hidden;
        }
        input[type="file"]::before {
            content: 'Select Image';
            display: inline-block;
            background: linear-gradient(to right, #4c51bf, #6b46c1); /* Blue to purple gradient */
            color: white;
            border-radius: 0.5rem; /* Rounded corners */
            padding: 0.75rem 1.5rem; /* Padding */
            outline: none;
            white-space: nowrap;
            -webkit-user-select: none;
            cursor: pointer;
            font-weight: 600; /* Semi-bold text */
            font-size: 1rem;
            transition: all 0.2s ease-in-out; /* Smooth transitions */
            border: none;
        }
        input[type="file"]:hover::before {
            background: linear-gradient(to right, #6b46c1, #4c51bf); /* Reverse gradient on hover */
            transform: scale(1.05); /* Slightly enlarge on hover */
        }
        input[type="file"]:active::before {
            background: linear-gradient(to right, #3c366b, #4c51bf); /* Darker gradient on active */
            transform: scale(0.95); /* Slightly shrink on active */
        }
    </style>
</head>
<body class="p-4 sm:p-6 bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-800 dark:to-gray-950 min-h-screen">
    <div class="container mx-auto bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden">
        <!-- Header Section -->
        <header class="bg-gradient-to-r from-blue-600 to-purple-700 p-6 text-white text-center rounded-t-2xl shadow-md">
            <h1 class="text-3xl md:text-4xl font-extrabold mb-2">
                My Tools Hub
            </h1>
            <p class="text-blue-100 text-lg">Your go-to place for all your favorite links!</p>
        </header>

        <!-- Main Content Area -->
        <main class="p-6">
            <!-- User ID Display Section -->
            <div id="userIdDisplay" class="mb-6 bg-blue-50 dark:bg-gray-700 p-4 rounded-xl text-blue-800 dark:text-blue-200 text-sm md:text-base hidden">
                <p class="font-semibold mb-1">Your User ID:</p>
                <p id="currentUserId" class="break-all"></p>
                <p class="mt-2 text-xs md:text-sm text-blue-600 dark:text-blue-300">
                    (This ID identifies your saved tools.)</p>
            </div>

            <!-- Global Error Message Display -->
            <div id="errorMessage" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-xl relative mb-6 hidden" role="alert">
                <strong class="font-bold">Error:</strong>
                <span id="errorText" class="block sm:inline ml-2"></span>
            </div>

            <!-- Loading Indicator -->
            <div id="loadingIndicator" class="flex items-center justify-center p-8 hidden">
                <svg class="animate-spin h-8 w-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <p class="ml-3 text-gray-700 dark:text-gray-300">Loading...</p>
            </div>

            <!-- Add New Tool Form Section -->
            <div class="mb-8 p-6 bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700">
                <h2 class="text-2xl font-bold mb-5 text-gray-800 dark:text-gray-100">Add New Tool</h2>
                <div id="formErrorMessage" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-xl relative mb-4 text-sm hidden" role="alert">
                    <span id="formErrorText" class="block sm:inline"></span>
                </div>
                <form id="toolForm" class="space-y-4">
                    <div>
                        <label for="toolName" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Tool Name</label>
                        <input
                            type="text"
                            id="toolName"
                            placeholder="e.g., Google Search"
                            class="mt-1 block w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100 transition duration-150 ease-in-out"
                            required
                        >
                    </div>
                    <div>
                        <label for="toolUrl" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Tool URL</label>
                        <input
                            type="url"
                            id="toolUrl"
                            placeholder="e.g., https://www.google.com"
                            class="mt-1 block w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100 transition duration-150 ease-in-out"
                            required
                        >
                    </div>
                    <button
                        type="submit"
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-xl shadow-md transform transition duration-200 ease-in-out hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800"
                    >
                        Add Tool
                    </button>
                </form>
            </div>

            <!-- Tool List Section -->
            <div class="p-6 bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 mb-8">
                <h2 class="text-2xl font-bold mb-5 text-gray-800 dark:text-gray-100">Your Tools</h2>
                <ul id="toolsList" class="space-y-4">
                    <!-- Tools will be rendered here by JavaScript -->
                    <p class="text-gray-600 dark:text-gray-400 text-center py-4" id="noToolsMessage">No tools added yet. Add some above!</p>
                </ul>
            </div>

            <!-- Image Resizer Tool Section -->
            <div class="p-6 bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700">
                <h2 class="text-2xl font-bold mb-5 text-gray-800 dark:text-gray-100">Image Resizer Tool</h2>
                <p class="text-gray-600 dark:text-gray-400 mb-4">Upload an image and resize it.</p>

                <div class="mb-4">
                    <label for="imageUpload" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Upload Image</label>
                    <input type="file" id="imageUpload" accept="image/*" class="w-full text-gray-900 dark:text-gray-100">
                </div>

                <!-- Image Preview and Original Dimensions -->
                <div id="imagePreviewContainer" class="hidden mb-6 p-4 border border-gray-200 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-700 text-center">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-2">Preview:</h3>
                    <img id="imagePreview" class="max-w-full h-auto mx-auto rounded-lg shadow-md mb-3" alt="Image Preview">
                    <p id="originalDimensions" class="text-gray-700 dark:text-gray-300 text-sm">Original size: -- x --</p>
                </div>

                <!-- Resize Options and Button -->
                <div id="resizeOptions" class="hidden space-y-4 mb-6">
                    <div>
                        <label for="newWidth" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">New Width (pixels)</label>
                        <input type="number" id="newWidth" placeholder="Width" class="mt-1 block w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100 transition duration-150 ease-in-out">
                    </div>
                    <div>
                        <label for="newHeight" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">New Height (pixels)</label>
                        <input type="number" id="newHeight" placeholder="Height" class="mt-1 block w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100 transition duration-150 ease-in-out">
                    </div>
                    <button id="resizeButton" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-4 rounded-xl shadow-md transform transition duration-200 ease-in-out hover:scale-105 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800">
                        Resize Image
                    </button>
                    <div id="resizeError" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-xl relative hidden text-sm" role="alert">
                        <span id="resizeErrorText" class="block sm:inline"></span>
                    </div>
                </div>

                <!-- Download Resized Image Section -->
                <div id="downloadContainer" class="hidden p-4 border border-green-200 dark:border-green-700 rounded-lg bg-green-50 dark:bg-green-700 text-center">
                    <h3 class="text-lg font-semibold text-green-800 dark:text-green-100 mb-2">Resized Image</h3>
                    <canvas id="resizedCanvas" class="max-w-full h-auto mx-auto border border-green-300 dark:border-green-600 rounded-lg shadow-md mb-3"></canvas>
                    <a id="downloadLink" download="resized_image.png" class="inline-block bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-5 rounded-lg shadow-md transition duration-200 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800">
                        Download Image
                    </a>
                </div>
            </div>
        </main>

        <!-- Footer Section -->
        <footer class="bg-gray-100 dark:bg-gray-900 p-4 text-center text-gray-600 dark:text-gray-400 text-sm rounded-b-2xl">
            <p>&copy; <span id="currentYear"></span> Tools Hub. All rights reserved.</p>
        </footer>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        // Firebase modules import from CDN
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, query } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // Global variables for Firebase instances and user ID
        let app;
        let db;
        let auth;
        let userId = null;

        // Get references to DOM elements for the Tools Hub functionality
        const userIdDisplay = document.getElementById('userIdDisplay');
        const currentUserId = document.getElementById('currentUserId');
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const toolForm = document.getElementById('toolForm');
        const toolNameInput = document.getElementById('toolName');
        const toolUrlInput = document.getElementById('toolUrl');
        const formErrorMessage = document.getElementById('formErrorMessage');
        const formErrorText = document.getElementById('formErrorText');
        const toolsList = document.getElementById('toolsList');
        const noToolsMessage = document.getElementById('noToolsMessage');

        // Get references to DOM elements for the Image Resizer functionality
        const imageUpload = document.getElementById('imageUpload');
        const imagePreviewContainer = document.getElementById('imagePreviewContainer');
        const imagePreview = document.getElementById('imagePreview');
        const originalDimensions = document.getElementById('originalDimensions');
        const resizeOptions = document.getElementById('resizeOptions');
        const newWidthInput = document.getElementById('newWidth');
        const newHeightInput = document.getElementById('newHeight');
        const resizeButton = document.getElementById('resizeButton');
        const resizeError = document.getElementById('resizeError');
        const resizeErrorText = document.getElementById('resizeErrorText');
        const downloadContainer = document.getElementById('downloadContainer');
        const resizedCanvas = document.getElementById('resizedCanvas');
        const downloadLink = document.getElementById('downloadLink');

        let currentImage = null; // Variable to store the uploaded Image object

        // --- Utility Functions ---

        /**
         * Displays a message in a specified HTML element.
         * @param {HTMLElement} element - The HTML element where the message will be displayed.
         * @param {string} text - The message text.
         * @param {boolean} isError - True if it's an error message, false otherwise.
         */
        function displayMessage(element, text, isError = false) {
            element.textContent = text;
            element.classList.remove('hidden');
            if (isError) {
                // Apply error styling
                element.classList.remove('bg-green-100', 'border-green-400', 'text-green-700');
                element.classList.add('bg-red-100', 'border-red-400', 'text-red-700');
            } else {
                // Apply success/info styling
                element.classList.remove('bg-red-100', 'border-red-400', 'text-red-700');
                element.classList.add('bg-green-100', 'border-green-400', 'text-green-700');
            }
        }

        /**
         * Hides a specified HTML message element.
         * @param {HTMLElement} element - The HTML element to hide.
         */
        function hideMessage(element) {
            element.classList.add('hidden');
        }

        // --- Firebase Initialization and Authentication ---

        // This function runs once the window fully loads
        window.onload = async function () {
            // Set the current year in the footer
            document.getElementById('currentYear').textContent = new Date().getFullYear();

            // Show loading indicator while Firebase initializes
            loadingIndicator.classList.remove('hidden');
            try {
                // Retrieve Firebase configuration and app ID from global variables
                // These variables are provided by the Canvas environment.
                const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id'; // Fallback ID for local testing

                // Initialize Firebase app and get service instances
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Authenticate the user. First try with a custom token if available,
                // otherwise sign in anonymously.
                if (typeof __initial_auth_token !== 'undefined') {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }

                // Set up an observer to listen for changes in the user's sign-in state.
                // This is crucial for getting the current user's ID (`uid`).
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid; // Set userId if authenticated
                    } else {
                        // If no user is authenticated (e.g., initial anonymous sign-in failed or signed out),
                        // generate a random UUID for a temporary session.
                        userId = crypto.randomUUID();
                    }
                    currentUserId.textContent = userId; // Display the userId
                    userIdDisplay.classList.remove('hidden'); // Show the userId display
                    loadingIndicator.classList.add('hidden'); // Hide loading indicator

                    // Once authentication is ready and userId is determined,
                    // set up the real-time listener for the tools collection.
                    setupToolsListener();
                });

            } catch (err) {
                // Catch and display any errors during Firebase initialization
                console.error("Firebase initialization error:", err);
                displayMessage(errorMessage, `Firebase loading error: ${err.message}`, true);
                loadingIndicator.classList.add('hidden');
            }
        };

        // --- Tools Hub Functions (Firebase Firestore Interaction) ---

        /**
         * Sets up a real-time listener for the user's tools collection in Firestore.
         * It fetches tools and renders them on the page.
         */
        function setupToolsListener() {
            if (!db || !userId) {
                // Ensure Firebase database and user ID are initialized before proceeding.
                // This check prevents operations before the app is fully ready.
                return;
            }
            // Construct the path to the user's private tools collection.
            // Data is stored under `/artifacts/{appId}/users/{userId}/tools`.
            const toolsCollectionRef = collection(db, `artifacts/${__app_id}/users/${userId}/tools`);
            // Create a query for the tools collection.
            // Note: `orderBy()` is intentionally avoided here as it requires Firestore indexes
            // which can cause runtime errors if not pre-configured. Sorting is done client-side.
            const q = query(toolsCollectionRef);

            // `onSnapshot` provides real-time updates:
            // It listens for changes and calls the callback function whenever data changes.
            onSnapshot(q, (snapshot) => {
                const fe
